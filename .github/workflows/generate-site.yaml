name: generate-site

on:
  pull_request: []
  push:   
    branches:
      - "main"

jobs:
  Update:
    name: Build and Deploy Interface
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Build and Update Site
        run: |
          docker build -t latex2md .
          docker run -i -v $PWD:/code latex2md
          git status

      - name: Deploy to gh-pages
        if: (github.event_name == 'push')
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          printf "GitHub Actor: ${GITHUB_ACTOR}\n"
          git config user.name "github-actions"
          git config user.email "github-actions@users.noreply.github.com"
          git config pull.rebase false
          git fetch || printf "fetch did not work\n"
          git checkout -b gh-pages || git checkout gh-pages
          git add src/
          git add _includes/paper
          set +e
          git status | grep modified
          if [ $? -eq 0 ]; then
              set -e
              printf "Changes\n"
              git commit -a -m "Automated push to update rse-ops site $(date '+%Y-%m-%d')" || exit 0
              git push origin gh-pages --force
          else
              set -e
              printf "No changes\n"
          fi
